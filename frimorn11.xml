<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="composeEvent Test" height="40" author="Google"
     author_email="calendar-gadget-questions@google.com">
   <Require feature="google.calendar-0.5" />
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
      <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
      <html>
      <body>

      <script>

      var mystring; 
      var meetingkey;
      
      function runxml() {
        console.log("hi");

        loadDoc();
           
        
        var url = "https://acmetsp-n.webex.com/WBXService/XMLService";

        function loadDoc() {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
              mystring = xhttp.responseText;
              console.log(mystring);
              var n = mystring.indexOf("<serv:attendee>");
              var y = mystring.indexOf("</serv:attendee>");
              var a = mystring.indexOf("<meet:meetingkey>");
              var b = mystring.indexOf("</meet:meetingkey>");
              meetingkey = mystring.substring(a+17, b);
              mystring = mystring.substring(n+15,y);
              console.log(mystring);
              console.log("meetingkey logging:" + meetingkey);
              console.log("above should work");
              console.log(xhttp.responseText);
            }
          };
          xhttp.open("POST", "https://acmetsp-n.webex.com/WBXService/XMLService", false);
          xhttp.setRequestHeader("Content-type", "application/xml");
          xhttp.send('<?xml version="1.0" encoding="utf-8"?> <serv:message xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:serv="http://www.webex.com/schemas/2002/06/service" xmlns:schemaLocation="http://www.webex.com/schemas/2002/06/service http://www.webex.com/schemas/2002/06/service/service.xsd"> <header> <securityContext> <webExID>ridhillo</webExID> <password>P@ss1234</password> <siteName>acmetsp-n</siteName> </securityContext> </header> <body> <bodyContent xsi:type="java:com.webex.service.binding.meeting.CreateMeeting"> <accessControl> <meetingPassword>Cisco123</meetingPassword> </accessControl> <metaData> <confName>Test Meeting</confName> <location></location> </metaData> <participants> <attendees> <attendee> <person> <email>johitchc@cisco.com</email> </person> <emailInvitations>TRUE</emailInvitations> </attendee> </attendees> </participants> <schedule> <startDate /> </schedule> <telephony> <telephonySupport>NONE</telephonySupport> </telephony> <attendeeOptions> <emailInvitations>TRUE</emailInvitations> </attendeeOptions> </bodyContent> </body> </serv:message>');


          //openics();
        }
      }


      function compose() {
        var eventData = {
          title: 'WebEx Meeting',
          details: 'Join your webex meeting with the meeting key here: https://acmetsp-n.webex.com',
          location: meetingkey,
          allDay: true,

          startTime: {year: 2016, month: 7, date: 22},

          // Within the data model, the end time is EXCLUSIVE. So the //endTime MUST
          // be on the day after the start time.
          endTime: {year: 2016, month: 7, date: 23},

          // Note that attendees MUST be sent in contact format.
          attendees: [
          {email: 'davem.gadgets@gmail.com'}
          ],

        // For more RRULE examples, please see http://www.ietf.org/rfc/rfc2445.txt
          rrule: 'RRULE:FREQ=YEARLY'
        };
        google.calendar.composeEvent(eventData);
      }

      </script>


      <center>

      <button onclick="runxml()">Get WebEx Key</button>
      <button onclick="compose()">Compose WebEx Event</button>
      <form>
        Name: <input type="text" name="fullname"><br>
        Email: <input type="text" name="email"><br>
        <input type="submit" value="Submit">
      </form>       

      </center>

      </body>
      </html>
    ]]>
  </Content>
</Module>
